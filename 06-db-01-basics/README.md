# Домашнее задание к занятию 1. «Типы и структура СУБД» - Леонид Хорошев

## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определённых данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:
- электронные чеки в json-виде - отлично подойдут документоориентированные базы данных, так как каждый чек является отдельным документом со своим набором позиций, суммой, датой покупки и т.д. В нашем случае можно использовать СУБД MongoDB;
- склады и автомобильные дороги для логистической компани - тут набор данных о товаре на складах (артикул, стоимость, количество позиций), а также об автодорогах (наименование, протяженность, расстояние между точками поставки и т.д.) отлично структурируется в формате взаимосвязанных друг с другом таблиц, что позволяет использовать реляционные базы данных, например PostrgeSQL, как более функциональную по сравнению с MySQL;
- генеалогические деревья - в данном случае можно применить СУБД на основе графов, где указать зависимости (родство) между отдельными ее элеиентами. Самый очевидный выбор - Neo4j (самая широко распространенная графовая СУБД в мире); 
- кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации - наиболее подходящий вариант - СУБД типа "ключ-значение", например Redis и Memcached. Их преимущество при работе с кэшем и другими временными данными - это возможность хранения всей информации в оперативной памяти, а аткже возможность присваивать данным time-to-live (далее - TTL), то есть задавать параметры жизненного цикла. Преимущества Redis - более широкий функционал, а Memcached - простота использования, но в данном конкретном случае я бы остановился на Redis, так как данная СУБД больше подходит для работы с идентификаторами клиентов за счет возможности применять политики вытеснения для ключей с истекшим TTL;
- отношения клиент-покупка для интернет-магазина - данном кейсе информация отлично ложится в формат структурированных таблиц (ФИО, Id клиента, даты покупки, артикул товара, количество, стоимость, скида и т.д.), следовательно, применям реляционную СУБД  PostrgeSQL.

## Задача 2

Вы создали распределённое высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт — это отдельная реализация вашей системы и для каждого пункта нужно привести классификацию):

- данные записываются на все узлы с задержкой до часа (асинхронная запись), по CAP-теореме классифицируем пункт как AP (система гарантирует устойчивость к разделению и доступность, так как данные пишутся на все узлы, но не гарантирует согласованность, так как присутствует задержка по времени между узлами);
- при сетевых сбоях система может разделиться на 2 раздельных кластера, по CAP-теореме классифицируем пункт как СA (система гарантирует доступность каждого кластера в отдельности, но не обладает устойчивостью к разделению);
- система может не прислать корректный ответ или сбросить соединение, по CAP-теореме классифицируем пункт как СP (система обеспечивает устойчивость к разделению и согласованность, но не гарантирует доступность, так как сброс соединения означает, что ни один из кластеров недоступен).

Согласно PACELC-теореме как бы вы классифицировали эти реализации?
Теорема PACELC — расширение теоремы CAP, которое гласит, что в случае разделения сети в распределённой компьютерной системе необходимо выбирать между доступностью и согласованностью (согласно теореме CAP), но в любом случае, даже если система работает нормально в отсутствии разделения (E), нужно выбирать между задержками (L) и согласованностью (C).

Классификация согласно PACELC-теореме:

- данные записываются на все узлы с задержкой до часа (асинхронная запись), по PACELC-теореме классифицируем данный пункт также как и по CAP-теореме - AP    система учтойчива к разделению и доступна, но не согласована тпо причине задержки записи данных;
- при сетевых сбоях система может разделиться на 2 раздельных кластера, по PACELC-теореме классифицируданный пункт можно классифицировать данный пункт как EC (система гарантирует доступность и согласованность, но не гарантирует отсутствие задержек), так и EL (систему можно настроить на работу без задержек, но при этом согласованностью придется принебречь, так как данные на разных узлах синхронизируются с определенной задержкой времени);
- система может не прислать корректный ответ или сбросить соединение, по PACELC-теореме классифицируем данный пункт также, как и по CAP-теореме -  СP (система обеспечивает устойчивость к разделению и согласованность, но не гарантирует доступность).

## Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему? 

Если коротко, то не могут, так как данные принципы взаимоисключают друг друга.

ACID — это набор требований к СУБД, обеспечивающих надёжность и предсказуемость её работы, то есть стандарт того, какие гарантии должна давать база данных, чтобы поддерживать транзакции (транзакция – способ изменить состояние взаимосвязанных данных сразу в нескольких местах). Так как транзакции нужны далеко не каждому сервису, то многие СУБД NoSQL жертвуют принципами ASID (атомарность, согласованность, изоляция, стойкость) ради более высокой производительности, и тут появляется принцип BASE, который противопоставляет себя ACID. Принципы, заложенные в BASE (базовая доступность, неустойчивое состояние и конечная согласованность) обеспечивают доступность и возможность работать в режиме мягкого состояния и конечной согласованности. Это означает, что система может оставаться доступной, даже если она находится в не полностью согласованном состоянии на определенном этапе. Такой подход может использоваться в распределенных системах, сетевых приложениях, Big Data и т.д.




## Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни,
- реакция на истечение таймаута.

Вы слышали о key-value-хранилище, которое имеет механизм Pub/Sub. 
Что это за система? Какие минусы выбора этой системы?

В основе данного системного решения целесообразно применить СУБД Redis. Данный факт обусловлен тем, что Redis отвечает требованиям, указанным в задании. Так, за фиксацию значений с временем жизни и реакцию на истечение таймаута отвечает механизм TTL, описанный в ответе к заданию 1. TTL позволяет настроить сроки хранения кэша в системе, а также обеспечить автоматическое удаление устаревших данных.

Кроме того, Redis также является СУБД типа "ключ-значение" (key-value-хранилище), это значит, что объекты в СУБД хранятся и извлекаются с помощью ключа. Такое решение позволяет избавится от таблиц, столбцов и взаимосвязей между объектами, что повышает скорость работы нашего решения с данными. 

Также Redis имеет встроенный механизм pub/sub (издатель-подписчик - поведенческий шаблон проектирования передачи сообщений). Применяя такой шаблон в хранилище типа "ключ-значение" (наше системное решение), мы получаем возможность подписываться на определенные события, которые происходят в СУБД. Это могут быть как уведомления об истечении тайм-аута хранения каких-либо данных, так и сведения в вновь добавленных объектах в нашу базу данных. Формат "подписки на события", реализуемый в механизме pub/sub позволяет выполнить настройку уведомлений индивидуально для каждого пользователя (либо групп пользователей).


---

